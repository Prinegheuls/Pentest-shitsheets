Active Directory Certificate Services (AD CS) is a Microsoft Windows server role that provides a public key infrastructure (PKI). It allows you to create, manage, and distribute digital certificates, which are used to secure communication and transactions across a network.

# Find the ADCS service

```
crackmapexec ldap domain.lab -u username -p password -M adcs
```
```
ldapsearch -H ldap://dc_IP -x -LLL -D 'CN=<user>,OU=Users,DC=domain,DC=local' -w '<password>' -b "CN=Enrollment Services,CN=Public Key Services,CN=Services,CN=CONFIGURATION,DC=domain,DC=local" dNSHostName
```
```
certutil.exe -config - -ping, certutil -dump
```

# Check for ESC 
```
certipy find -u [USER] -p [PASSWORD] -dc-ip [DC_IP]
certipy find -u [USER] -p [PASSWORD] -dc-ip [DC_IP] -vulnerable -stdout
```
```
runas /netonly /user:CONTOSO\Jeff.Dimmock cmd.exe

Certify.exe cas
Certify.exe find /vulnerable
Certify.exe find /vulnerable /currentuser
```
## Check for ESC8 

```
http://[DC]/certsrv/certfnsh.asp
```

# Persistence

Certificates are still usable even if the user or computer resets their password!
